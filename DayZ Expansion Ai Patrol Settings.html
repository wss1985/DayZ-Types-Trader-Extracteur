<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DayZ Expansion Ai Patrol Settings</title>
    <style>
        body { background: #0f0f0f; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        textarea { width: 100%; height: 100px; background: #1a1a1a; color: #2ecc71; border: 1px solid #333; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: monospace; }
        
        .card { background: #1a1a1a; border: 1px solid #333; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-top: 4px solid #3498db; position: relative; }
        .card h3 { margin: 0 0 20px 0; color: #3498db; display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px; border-radius: 4px; }
        
        .grid-settings { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .setting-group { display: flex; flex-direction: column; background: #252525; padding: 10px; border-radius: 4px; border: 1px solid #333; }
        label { font-size: 0.7em; color: #f1c40f; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        
        input, select { background: #000; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 3px; font-size: 0.9em; }
        input:focus, select:focus { border-color: #3498db; outline: none; }

        .waypoints-section { margin-top: 20px; padding-top: 15px; border-top: 1px solid #333; }
        .wp-row { display: flex; gap: 8px; margin-bottom: 5px; align-items: center; }
        .wp-num { width: 30px; font-weight: bold; color: #e74c3c; }
        .wp-inputs { flex-grow: 1; display: flex; gap: 10px; }
        .wp-inputs div { display: flex; align-items: center; gap: 5px; flex: 1; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add { background: #27ae60; color: white; margin-top: 10px; }
        .btn-del { background: #c0392b; color: white; padding: 5px 10px; font-size: 0.8em; }
        .btn-clone { background: #f39c12; color: white; margin-top: 10px; width: 100%; }
        .btn-main { width: 100%; font-size: 1.1em; margin-bottom: 10px; }
        .btn-copy { background: #3498db; color: white; }
        .btn-gen { background: #8e44ad; color: white; margin-top: 20px; }

        .header-actions { display: flex; gap: 10px; position: sticky; top: 0; z-index: 100; background: #0f0f0f; padding: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>ü§ñ DayZ Expansion Ai Patrol Settings</h1>
    
    <textarea id="patrolInput" placeholder="Collez ici le contenu de votre fichier AIPatrolSettings.json"></textarea>
    
    <div class="header-actions">
        <button class="btn btn-main" style="background:#27ae60; color:white;" onclick="loadData()">‚ö° ANALYSER & √âDITER</button>
        <button id="copyBtn" class="btn btn-main btn-copy" style="display:none;" onclick="copyClipboard()">üìã COPIER LE R√âSULTAT</button>
    </div>

    <div id="editorArea"></div>

    <button id="genBtn" class="btn btn-main btn-gen" style="display:none;" onclick="generateJSON()">üíæ APPLIQUER TOUTES LES MODIFICATIONS</button>
</div>

<script>
    let data = null;

    // Listes des options demand√©es
    const factions = ["West", "East", "Guards", "RANDOM"];
    const loadouts = ["BanditLoadout", "EastLoadout", "FreshSpawnLoadout", "SurvivorLoadout", "WestLoadout", "FireFighterLoadout", "GorkaLoadout", "HumanLoadout", "NBCLoadout", "PoliceLoadout", "TTSKOLoadout", "YeetBrigadeLoadout", "YellowKingLoadout"];

    function loadData() {
        try {
            data = JSON.parse(document.getElementById('patrolInput').value);
            render();
            document.getElementById('copyBtn').style.display = 'block';
            document.getElementById('genBtn').style.display = 'block';
        } catch(e) { alert("Erreur JSON : v√©rifiez le fichier !"); }
    }

    function render() {
        const area = document.getElementById('editorArea');
        area.innerHTML = "";

        data.Patrols.forEach((p, pIdx) => {
            const card = document.createElement('div');
            card.className = 'card';
            
            let wpHTML = p.Waypoints.map((wp, wIdx) => `
                <div class="wp-row">
                    <span class="wp-num">#${wIdx+1}</span>
                    <div class="wp-inputs">
                        <div><label>X</label><input type="number" step="0.01" value="${wp[0]}" onchange="updateWP(${pIdx},${wIdx},0,this.value)"></div>
                        <div><label>Z</label><input type="number" step="0.01" value="${wp[2]}" onchange="updateWP(${pIdx},${wIdx},2,this.value)"></div>
                    </div>
                    <button class="btn btn-del" onclick="removeWP(${pIdx},${wIdx})">Suppr</button>
                </div>
            `).join('');

            // G√©n√©ration des options pour les Selects
            let factionOpts = factions.map(f => `<option value="${f}" ${p.Faction === f ? 'selected' : ''}>${f}</option>`).join('');
            let loadoutOpts = loadouts.map(l => `<option value="${l}" ${p.Loadout === l ? 'selected' : ''}>${l}</option>`).join('');

            card.innerHTML = `
                <h3>
                    <input type="text" value="${p.Name || ''}" placeholder="Nom de la patrouille" onchange="upVal(${pIdx},'Name',this.value)" style="background:transparent; border:none; color:#3498db; font-size:1.1em; font-weight:bold; width:300px;">
                    <span style="font-size:0.7em; color:#666;">ID: ${pIdx}</span>
                </h3>

                <div class="grid-settings">
                    <div class="setting-group">
                        <label>üõ°Ô∏è Faction</label>
                        <select onchange="upVal(${pIdx},'Faction',this.value)">${factionOpts}</select>
                    </div>
                    <div class="setting-group">
                        <label>üìÇ Loadout</label>
                        <select onchange="upVal(${pIdx},'Loadout',this.value)">${loadoutOpts}</select>
                    </div>
                    <div class="setting-group"><label>üë• Nb IA Min</label><input type="number" value="${p.NumberOfAI}" onchange="upVal(${pIdx},'NumberOfAI',parseInt(this.value))"></div>
                    <div class="setting-group"><label>üë• Nb IA Max</label><input type="number" value="${p.NumberOfAIMax}" onchange="upVal(${pIdx},'NumberOfAIMax',parseInt(this.value))"></div>
                    <div class="setting-group">
                        <label>üß† Comportement</label>
                        <select onchange="upVal(${pIdx},'Behaviour',this.value)">
                            <option value="ROAMING" ${p.Behaviour=='ROAMING'?'selected':''}>ROAMING</option>
                            <option value="ALTERNATE" ${p.Behaviour=='ALTERNATE'?'selected':''}>ALTERNATE</option>
                            <option value="LOOP" ${p.Behaviour=='LOOP'?'selected':''}>LOOP</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>üéí Looting</label>
                        <select onchange="upVal(${pIdx},'LootingBehaviour',this.value)">
                            <option value="ALL" ${p.LootingBehaviour=='ALL'?'selected':''}>ALL</option>
                            <option value="NONE" ${p.LootingBehaviour=='NONE'?'selected':''}>NONE</option>
                        </select>
                    </div>
                    <div class="setting-group"><label>üèÉ Vitesse</label>
                        <select onchange="upVal(${pIdx},'Speed',this.value)">
                            <option value="WALK" ${p.Speed=='WALK'?'selected':''}>WALK</option>
                            <option value="JOG" ${p.Speed=='JOG'?'selected':''}>JOG</option>
                            <option value="SPRINT" ${p.Speed=='SPRINT'?'selected':''}>SPRINT</option>
                        </select>
                    </div>
                    <div class="setting-group"><label>‚ö° Vitesse Menace</label>
                        <select onchange="upVal(${pIdx},'UnderThreatSpeed',this.value)">
                            <option value="SPRINT" ${p.UnderThreatSpeed=='SPRINT'?'selected':''}>SPRINT</option>
                            <option value="JOG" ${p.UnderThreatSpeed=='JOG'?'selected':''}>JOG</option>
                        </select>
                    </div>
                    <div class="setting-group"><label>üßò Posture</label>
                        <select onchange="upVal(${pIdx},'DefaultStance',this.value)">
                            <option value="STANDING" ${p.DefaultStance=='STANDING'?'selected':''}>STANDING</option>
                            <option value="CROUCH" ${p.DefaultStance=='CROUCH'?'selected':''}>CROUCH</option>
                        </select>
                    </div>
                    <div class="setting-group"><label>üíÄ Lootable ?</label><input type="number" value="${p.CanBeLooted}" onchange="upVal(${pIdx},'CanBeLooted',parseInt(this.value))"></div>
                    <div class="setting-group"><label>üî´ Mag Illimit√©</label><input type="number" value="${p.UnlimitedReload}" onchange="upVal(${pIdx},'UnlimitedReload',parseInt(this.value))"></div>
                    <div class="setting-group"><label>üé≤ Start Al√©atoire</label><input type="number" value="${p.UseRandomWaypointAsStartPoint}" onchange="upVal(${pIdx},'UseRandomWaypointAsStartPoint',parseInt(this.value))"></div>
                    <div class="setting-group"><label>üìà Chance (0-1)</label><input type="number" step="0.1" value="${p.Chance}" onchange="upVal(${pIdx},'Chance',parseFloat(this.value))"></div>
                </div>

                <div class="waypoints-section">
                    <label>üõ§Ô∏è Itin√©raire (Waypoints)</label>
                    <div id="wp-list-${pIdx}">${wpHTML}</div>
                    <button class="btn btn-add" onclick="addWP(${pIdx})">+ Ajouter un Waypoint</button>
                    <button class="btn btn-clone" onclick="clonePatrol(${pIdx})">üëØ Cloner cette patrouille</button>
                </div>
            `;
            area.appendChild(card);
        });
    }

    function upVal(pIdx, key, val) { data.Patrols[pIdx][key] = val; }
    function updateWP(pIdx, wIdx, cIdx, val) { data.Patrols[pIdx].Waypoints[wIdx][cIdx] = parseFloat(val); }
    
    function addWP(pIdx) {
        const wps = data.Patrols[pIdx].Waypoints;
        const last = wps[wps.length - 1];
        wps.push([last[0] + 10, 0.0, last[2] + 10]);
        render();
    }

    function removeWP(pIdx, wIdx) {
        if (data.Patrols[pIdx].Waypoints.length > 1) {
            data.Patrols[pIdx].Waypoints.splice(wIdx, 1);
            render();
        }
    }

    function clonePatrol(pIdx) {
        let copy = JSON.parse(JSON.stringify(data.Patrols[pIdx]));
        copy.Name += "_copie";
        data.Patrols.push(copy);
        render();
        window.scrollTo(0, document.body.scrollHeight);
    }

    function generateJSON() {
        document.getElementById('patrolInput').value = JSON.stringify(data, null, 4);
        window.scrollTo(0,0);
    }

    function copyClipboard() {
        generateJSON();
        const el = document.getElementById('patrolInput');
        el.select();
        navigator.clipboard.writeText(el.value);
        alert("Fichier copi√© ! Pr√™t √† √™tre coll√©.");
    }
</script>
</body>
</html>